# ü§ñ Papu Panes Bot - Integraci√≥n de Redes Sociales

Bot de Telegram que procesa autom√°ticamente contenido de redes sociales usando FxTwitter, InstaFix y vxTikTok.

## üöÄ Funcionalidades

### ‚úÖ Funcionalidades Originales (Mantenidas)
- Comando `/scream` - Convierte mensajes a may√∫sculas
- Comando `/whisper` - Desactiva el modo scream
- Comando `/menu` - Men√∫ interactivo con botones
- Forwarding autom√°tico de mensajes

### üÜï Nuevas Funcionalidades de Redes Sociales
- **Detecci√≥n Autom√°tica**: Detecta URLs de Twitter, Instagram y TikTok
- **Procesamiento de Contenido**: Extrae informaci√≥n y medios de posts
- **Env√≠o Multimedia**: Env√≠a im√°genes, videos y GIFs con informaci√≥n
- **URLs Fijas**: Genera enlaces sin restricciones
- **Comandos √ötiles**: Herramientas para testing y ayuda

## üì± Comandos Disponibles

### Comandos Originales
- `/scream` - Activa modo scream (mensajes en may√∫sculas)
- `/whisper` - Desactiva modo scream
- `/menu` - Muestra men√∫ interactivo

### Comandos de Redes Sociales
- `/fix` - Obtiene URLs fijas para contenido de redes sociales
- `/help_social` - Muestra ayuda sobre funcionalidades de redes sociales
- `/status` - Muestra el estado de los servicios
- `/test <URL>` - Prueba una URL espec√≠fica

## üîß Instalaci√≥n y Uso

### 1. Instalar Dependencias
```bash
npm install
```

### 2. Configurar el Bot
```bash
# Copiar archivo de configuraci√≥n de ejemplo
cp config/bot.config.example.ts config/bot.config.ts

# Editar config/bot.config.ts y agregar tu token del bot
```

### 3. Probar la Integraci√≥n
```bash
npm test
```

### 4. Ejecutar el Bot
```bash
# Desarrollo (con auto-reload)
npm run dev

# Producci√≥n
npm start
```

## üéØ C√≥mo Usar

### Procesamiento Autom√°tico
Simplemente env√≠a una URL de redes sociales al bot y autom√°ticamente:
1. Detectar√° la plataforma
2. Extraer√° el contenido
3. Enviar√° el post con informaci√≥n detallada

### Ejemplos de URLs Soportadas

#### Twitter/X
```
https://twitter.com/usuario/status/1234567890123456789
https://x.com/usuario/status/1234567890123456789
https://t.co/ABC123
```

#### Instagram
```
https://instagram.com/p/ABC123DEF456/
https://instagram.com/reel/ABC123DEF456/
https://instagr.am/p/ABC123/
```

#### TikTok
```
https://tiktok.com/@usuario/video/1234567890123456789
https://vm.tiktok.com/ABC123/
https://vt.tiktok.com/ABC123/
```

### Comandos de Prueba

```bash
# Probar detecci√≥n de URLs
/test https://twitter.com/elonmusk/status/1234567890123456789

# Ver estado de servicios
/status

# Obtener ayuda
/help_social
```

## üèóÔ∏è Arquitectura

El bot utiliza una arquitectura modular:

```
papuPanes_bot.ts (Bot principal)
‚îú‚îÄ‚îÄ src/services/social-media/ (Servicios de plataformas)
‚îú‚îÄ‚îÄ src/utils/ (Utilidades)
‚îú‚îÄ‚îÄ src/bot/handlers/ (Manejadores del bot)
‚îú‚îÄ‚îÄ src/bot/commands/ (Comandos)
‚îî‚îÄ‚îÄ src/config/ (Configuraci√≥n)
```

### Componentes Principales

- **SocialMediaManager**: Coordina todos los servicios
- **SocialMediaHandler**: Maneja mensajes del bot
- **URL Utils**: Detecta y procesa URLs
- **Media Utils**: Formatea contenido para Telegram

## üîå APIs Integradas

- **FxTwitter**: `https://api.fxtwitter.com`
- **InstaFix**: `https://instafix.io`
- **vxTikTok**: `https://vxtiktok.com`

## üìä Flujo de Procesamiento

1. **Recepci√≥n**: Bot recibe mensaje con URL
2. **Detecci√≥n**: Identifica si es URL de redes sociales
3. **Extracci√≥n**: Obtiene informaci√≥n via API
4. **Formateo**: Prepara contenido para Telegram
5. **Env√≠o**: Env√≠a multimedia con informaci√≥n

## üõ†Ô∏è Configuraci√≥n

### Configuraci√≥n del Bot

1. **Copiar archivo de configuraci√≥n**:
   ```bash
   cp config/bot.config.example.ts config/bot.config.ts
   ```

2. **Editar configuraci√≥n**:
   Edita `config/bot.config.ts` y reemplaza `YOUR_BOT_TOKEN_HERE` con tu token real del bot.

   ```typescript
   export const botConfig = {
     token: "TU_TOKEN_REAL_AQUI",
     options: {
       enableSocialMedia: true,    // Habilitar funcionalidades de redes sociales
       enableScreamMode: true,     // Habilitar comandos /scream y /whisper
       enableMenu: true,           // Habilitar comando /menu
       silentReplies: true,        // Usar notificaciones silenciosas
       logMessages: true,          // Loggear mensajes en consola
     }
   };
   ```

### Habilitar/Deshabilitar Plataformas
Edita `src/config/social-media-config.ts`:

```typescript
export const socialMediaConfig: SocialMediaConfig = {
  twitter: {
    enabled: true,  // Cambiar a false para deshabilitar
    fxTwitterBaseUrl: 'https://api.fxtwitter.com'
  },
  // ...
};
```

### URLs de APIs Personalizadas
Puedes cambiar las URLs base de las APIs:

```typescript
twitter: {
  enabled: true,
  fxTwitterBaseUrl: 'https://tu-instancia-fxtwitter.com'
}
```

### Opciones de Configuraci√≥n

| Opci√≥n | Descripci√≥n | Valor por defecto |
|--------|-------------|-------------------|
| `enableSocialMedia` | Habilita procesamiento de URLs de redes sociales | `true` |
| `enableScreamMode` | Habilita comandos `/scream` y `/whisper` | `true` |
| `enableMenu` | Habilita comando `/menu` | `true` |
| `silentReplies` | Usa notificaciones silenciosas para respuestas | `true` |
| `logMessages` | Loggea mensajes entrantes en consola | `true` |
| `enableWhitelist` | Habilita sistema de whitelist de usuarios | `true` |
| `requireOwnerInGroup` | Requiere que el owner est√© en el grupo para que el bot responda | `true` |
| `ownerId` | ID del usuario owner del bot | `123456789` |
| `whitelistedUsers` | Array de IDs de usuarios autorizados | `[123456789]` |

### üõ°Ô∏è Control de Acceso (Whitelist)

El bot incluye un sistema de whitelist que permite controlar qui√©n puede usar el bot:

#### Configuraci√≥n de Whitelist

```typescript
export const botConfig = {
  token: "TU_TOKEN_REAL_AQUI",
  options: {
    // ... otras opciones
    
    // Control de acceso
    enableWhitelist: true,              // Activar sistema de whitelist
    requireOwnerInGroup: true,          // Requiere owner en grupo
    ownerId: 123456789,                 // Tu ID de usuario de Telegram
    whitelistedUsers: [123456789],      // IDs de usuarios autorizados
  }
};
```

#### C√≥mo Obtener tu ID de Usuario

1. Habla con [@userinfobot](https://t.me/userinfobot) en Telegram
2. Copia tu ID num√©rico
3. Agr√©galo como `ownerId` en la configuraci√≥n

#### Funcionamiento del Sistema

- **Whitelist deshabilitada**: El bot responde a todos los usuarios
- **Whitelist habilitada**: Solo responde a usuarios en `whitelistedUsers`
- **Owner en grupo**: Si `requireOwnerInGroup` es `true`, el owner debe estar en el grupo para que el bot funcione
- **Chats privados**: El bot siempre funciona en chats privados con usuarios autorizados

#### Agregar Usuarios a la Whitelist

```typescript
whitelistedUsers: [
  123456789,  // Owner ID
  987654321,  // Usuario autorizado 1
  456789123,  // Usuario autorizado 2
  // ... m√°s usuarios
]
```

#### Comportamiento de Seguridad

- **Rechazo silencioso**: El bot ignora mensajes de usuarios no autorizados
- **Logs de seguridad**: Registra intentos de acceso no autorizados
- **Verificaci√≥n en tiempo real**: Comprueba permisos en cada mensaje
- **Protecci√≥n de comandos**: Todos los comandos requieren autorizaci√≥n

## üß™ Testing

### Script de Pruebas
```bash
npm test
```

Este script prueba:
- Detecci√≥n de URLs
- Extracci√≥n de URLs de texto
- Estado de servicios
- Generaci√≥n de URLs fijas

### Pruebas Manuales
1. Env√≠a una URL de Twitter al bot
2. Verifica que procese correctamente
3. Usa `/status` para verificar servicios
4. Usa `/test <URL>` para pruebas espec√≠ficas

## üîç Logs y Debugging

El bot incluye logs detallados:

```
üîç URL de redes sociales detectada, procesando...
üîÑ Procesando contenido...
‚úÖ Contenido procesado exitosamente
```

### Errores Comunes
- **API no disponible**: Verificar URLs de APIs
- **Rate limiting**: Esperar antes de nuevas peticiones
- **URLs inv√°lidas**: Verificar formato de URLs

## üìù Notas Importantes

- Las APIs de terceros pueden tener l√≠mites de rate
- Algunas URLs pueden requerir autenticaci√≥n
- El contenido multimedia puede tener restricciones de tama√±o
- Siempre manejar errores de red y timeouts

## üöÄ Pr√≥ximas Mejoras

- [ ] Soporte para YouTube
- [ ] Cach√© de contenido
- [ ] Estad√≠sticas de uso
- [ ] Configuraci√≥n por chat
- [ ] Filtros de contenido

## ü§ù Contribuci√≥n

Para agregar nuevas funcionalidades:

1. Mantener la arquitectura modular
2. Seguir los patrones establecidos
3. Agregar tipos TypeScript apropiados
4. Incluir manejo de errores
5. Documentar cambios

---

**¬°Tu bot ahora puede procesar contenido de redes sociales autom√°ticamente! üéâ** 